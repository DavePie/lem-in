(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();class S{constructor(t,s,e,i=!1){this.name=t,this.pos=[s,e],this.isSpecial=i}}class E{constructor(){this.rooms={}}addRoom(t,s,e,i=!1){if(!(t in this.rooms))this.rooms[t]=new S(t,s,e,i);else throw new Error(`Room "${t}" already exists.`);if(i==="start"){if(this.start)throw new Error("Start room already exists.");this.start=this.rooms[t]}else if(i==="end"){if(this.end)throw new Error("End room already exists.");this.end=this.rooms[t]}}exists(t){return t in this.rooms}getPositionsTab(){let t=[];for(let s in this.rooms)t.push(this.rooms[s].pos);return t}}class v{constructor(t,s){this.room1=t.pos,this.room2=s.pos,this.color=[255,255,255]}}class P{constructor(){this.links={},this.splitKey=this.generateRandomKey(12)}generateRandomKey(t){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~!@#$%^&*()_+[]{}|;:,./<>?";let e="";for(let i=0;i<t;i++)e+=s.charAt(Math.floor(Math.random()*s.length));return e}addLink(t,s){const e=t.name<s.name?`${t.name}${this.splitKey}${s.name}`:`${s.name}${this.splitKey}${t.name}`;if(!(e in this.links))this.links[e]=new v(t,s);else throw new Error(`Link between rooms ${t.name} and ${s.name} already exists.`)}exists(t,s){return t=typeof t=="string"?t:t.name,s=typeof s=="string"?s:s.name,(t<s?`${t}${this.splitKey}${s}`:`${s}${this.splitKey}${t}`)in this.links}getLink(t,s){t=typeof t=="string"?t:t.name,s=typeof s=="string"?s:s.name;const e=t<s?`${t}${this.splitKey}${s}`:`${s}${this.splitKey}${t}`,i=this.links[e];if(i)return i;throw new Error(`Link between rooms ${t} and ${s} does not exist.`)}getLinksTab(){let t=[];for(let s in this.links){const e=this.links[s];t.push([e.room1,e.room2,e.color])}return t}}class ${constructor(t,s){this.num=t,this.positions=Array.from({length:t},()=>[s]),this.links=Array.from({length:t},()=>[]),this.colors=Array.from({length:t},()=>[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]),this.steps=0}addPosition(t,s,e){if(t>0&&t<=this.num)this.positions[t-1][e]=s;else throw new Error(`Invalid ant ID: ${t}.`)}addLink(t,s,e){if(t>0&&t<=this.num)this.links[t-1][e]=s;else throw new Error(`Invalid ant ID: ${t}.`)}addStep(t,s,e,i){t=t.split(" "),this.positions.forEach(a=>{a.push(null)}),this.links.forEach(a=>{a.push(null)}),t.forEach(a=>{if(!a.match(/^L\d+-\w+$/))throw new Error(`Invalid move "${a}" at step ${s}.`);let[r,l]=a.split("-");if(r=parseInt(r.slice(1)),e.exists(l))this.addPosition(r,e.rooms[l],s);else throw new Error(`Room "${l}" does not exist.`);if(s>0&&!i.exists(this.getPosition(r,s-1),e.rooms[l]))throw new Error(`Link between rooms ${this.getPosition(r,s-1).name} and ${l} does not exist.`);s>0&&this.addLink(r,i.getLink(this.getPosition(r,s-1),l),s)}),this.positions.forEach((a,r)=>{a[s]===null&&(a[s]=s>0?a[s-1]:e.start)}),s>this.steps&&(this.steps=s)}getPosition(t,s){if(t>0&&t<=this.num)return this.positions[t-1][s];throw new Error(`Invalid ant ID: ${t}.`)}getLinkUsed(t,s){if(t>0&&t<=this.num)return this.links[t-1][s];throw new Error(`Invalid ant ID: ${t}.`)}}class C{constructor(t){this.param=t,this.simState=t.simState,this.canvas=t.canvas,this.ctx=this.canvas.getContext("2d"),this.rooms=t.rooms,this.links=t.links,this.ants=t.ants,this.margin=50,this.scale=1,this.offsetX=0,this.offsetY=0,this.dragging=!1,this.lastMousePos={x:0,y:0},this.setupEventListeners(),this.resize(),window.addEventListener("resize",()=>this.resize()),this.updateStep()}setupEventListeners(){this.canvas.addEventListener("wheel",t=>this.handleZoom(t)),this.canvas.addEventListener("mousedown",t=>this.handleMouseDown(t)),this.canvas.addEventListener("mousemove",t=>this.handleMouseMove(t)),this.canvas.addEventListener("mouseup",()=>this.handleMouseUp()),this.canvas.addEventListener("mouseleave",()=>this.handleMouseUp())}handleZoom(t){t.preventDefault();const s=1.1,e=t.deltaY<0?s:1/s,{offsetX:i,offsetY:a}=t;this.scale*=e,this.offsetX=i-(i-this.offsetX)*e,this.offsetY=a-(a-this.offsetY)*e,this.updateStep()}handleMouseDown(t){this.dragging=!0,this.lastMousePos={x:t.clientX,y:t.clientY}}handleMouseMove(t){if(this.dragging){const s=t.clientX-this.lastMousePos.x,e=t.clientY-this.lastMousePos.y;this.offsetX+=s,this.offsetY+=e,this.lastMousePos={x:t.clientX,y:t.clientY},this.updateStep()}}handleMouseUp(){this.dragging=!1}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.calculateScaling(),this.updateStep()}calculateScaling(){const t=this.rooms.getPositionsTab(),s=t.map(o=>o[0]),e=t.map(o=>o[1]),i=Math.min(...s),a=Math.max(...s),r=Math.min(...e),l=Math.max(...e);this.scale=Math.min((this.canvas.width-2*this.margin)/(a-i),(this.canvas.height-2*this.margin)/(l-r)),this.offsetX=(this.canvas.width-(a-i)*this.scale)/2-i*this.scale,this.offsetY=(this.canvas.height-(l-r)*this.scale)/2-r*this.scale;let p=1/0;for(let o=0;o<t.length;o++)for(let n=o+1;n<t.length;n++){const c=Math.hypot(t[o][0]-t[n][0],t[o][1]-t[n][1]);c<p&&c!==0&&(p=c)}this.roomDiameter=p/3*this.scale}clearScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}draw(){this.clearScreen(),this.drawLinks(),this.drawRooms()}drawRooms(){for(const t in this.rooms.rooms){const s=this.rooms.rooms[t],[e,i]=this.transform(s.pos);(s.isSpecial==="start"||s.isSpecial==="end")&&(this.ctx.beginPath(),this.ctx.arc(e,i,this.roomDiameter*.65,0,2*Math.PI),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(e,i,this.roomDiameter*.55,0,2*Math.PI),this.ctx.fillStyle="black",this.ctx.fill()),this.ctx.beginPath(),this.ctx.arc(e,i,this.roomDiameter/2,0,2*Math.PI),this.ctx.fillStyle="white",this.ctx.fill()}}drawLinks(){this.links.getLinksTab().forEach(s=>{const[e,i,a]=s,[r,l]=this.transform(e),[p,o]=this.transform(i);this.ctx.fillStyle=`rgb(${a[0]}, ${a[1]}, ${a[2]})`;const n=Math.atan2(o-l,p-r),c=Math.hypot(p-r,o-l),u=this.roomDiameter/6;this.ctx.save(),this.ctx.translate(r,l),this.ctx.rotate(n),this.ctx.fillRect(0,-u/2,c,u),this.ctx.restore()})}updateStep(){this.clearScreen(),this.drawLinks(),this.drawRooms();const t=this.simState.step;for(let s=0;s<this.ants.num;s++){const e=this.ants.getPosition(s+1,t),[i,a]=this.transform(e.pos);this.ctx.fillStyle=`rgb(${this.ants.colors[s][0]}, ${this.ants.colors[s][1]}, ${this.ants.colors[s][2]})`,this.ctx.beginPath(),this.ctx.arc(i,a,this.roomDiameter/4,0,2*Math.PI),this.ctx.fill()}}animateToStep(){return new Promise(t=>{const s=this.simState.step-1,e=this.simState.step,i=1e3/this.simState.speed;let a;const r=l=>{a||(a=l);const p=Math.min((l-a)/i,1);this.clearScreen(),this.drawLinks(),this.drawRooms();for(let o=0;o<this.ants.num;o++){const n=this.ants.getPosition(o+1,s),c=this.ants.getPosition(o+1,e);n!=c&&this.links.getLink(n,c).color[0]===255&&(this.links.getLink(n,c).color=this.ants.colors[o]);const[u,y]=this.transform(n.pos),[b,k]=this.transform(c.pos),x=u+(b-u)*p,L=y+(k-y)*p;this.ctx.fillStyle=`rgb(${this.ants.colors[o][0]}, ${this.ants.colors[o][1]}, ${this.ants.colors[o][2]})`,this.ctx.beginPath(),this.ctx.arc(x,L,this.roomDiameter/4,0,2*Math.PI),this.ctx.fill()}p<1?requestAnimationFrame(r):(this.updateStep(),t())};requestAnimationFrame(r)})}transform(t){return[t[0]*this.scale+this.offsetX,t[1]*this.scale+this.offsetY]}}const w=new Tweakpane.Pane;function I(h){return new Promise(t=>setTimeout(t,h))}class M{constructor(t,s){this.params=t,this.onValidate=s,this.folder=w.addFolder({title:"AntFarm Settings",expanded:!0}),this.textArea=document.createElement("textarea"),this.textArea.rows=10,this.textArea.cols=50,this.textArea.placeholder="Enter AntFarm configuration here...",this.textArea.style.width="95%",this.folder.element.appendChild(this.textArea),this.folder.addButton({title:"Validate ant farm"}).on("click",()=>{this.validate()})}async validate(){this.params.vis&&this.params.vis.clearScreen(),this.params.gui.playbackController&&(this.params.gui.playbackController.container.remove(),delete this.params.gui.playbackController,this.params.gui.playbackController=null);const t=this.params.simState.in_anim?1e3/this.params.simState.speed:0;this.resetParams();try{[this.params.rooms,this.params.links,this.params.ants]=this.parseInput(this.getInputValue())}catch(s){this.params.farmValid=!1,console.error(s),this.params.popup.show(s.message)}await I(t),this.params.rooms&&this.params.links&&this.params.ants&&(this.params.farmValid=!0),this.onValidate&&this.onValidate(this.params.farmValid),this.params.farmValid&&(this.params.vis=new C(this.params))}resetParams(){this.params.farmValid=!1,this.params.simValid=!1,this.params.gui.playbackController&&(console.log("Removing playback controller"),this.params.gui.playbackController.container.remove(),delete this.params.gui.playbackController,this.params.gui.playbackController=null),delete this.params.rooms,this.params.rooms=null,delete this.params.links,this.params.links=null,delete this.params.ants,this.params.ants=null,delete this.params.sim,this.params.sim=null,delete this.params.vis,this.params.vis=null,this.params.simState.step=0,this.params.simState.speed=1,this.params.simState.len=1,this.params.simState.is_playing=!1,this.params.simState.in_anim=!1}getInputValue(){return this.textArea.value}parseInput(t){const s=t.split(`
`).map(n=>n.trim()).filter(n=>n.length>0),e=new E,i=new P;let a,r=!1,l=!0;if(s.length===0)throw new Error("No input provided.");let p=0;for(let n of s)if(p++,!(n.startsWith("#")&&!n.startsWith("##")))if(n.startsWith("##"))if(n==="##start"||n==="##end")r=n.slice(2);else throw new Error(`Invalid preprocessor command.
 Line `+p+": "+n);else if(n.match(/^\d+$/)&&l){if(r!==!1)throw new Error(`Preprocessor command before number of ants.
 Line `+p+": "+n);a=parseInt(n),l=!1}else{if(l)throw new Error("First instruction must be number of ants.");if(n.match(/^\w+ \d+ \d+$/)){const[c,u,y]=n.split(" ");e.addRoom(c,parseInt(u),parseInt(y),r),r=!1}else if(n.match(/^\w+-\w+$/)){if(r!==!1)throw new Error(`Preprocessor command before link.
 Line `+p+": "+n);const[c,u]=n.split("-");if(!e.exists(c)||!e.exists(u))throw new Error(`Link between non-existing rooms.
 Line `+p+": "+n);i.addLink(e.rooms[c],e.rooms[u])}else throw new Error(`Invalid instruction.
 Line `+p+": "+n)}if(l)throw new Error("Empty input.");if(!e.start||!e.end)throw new Error("No start or end room.");const o=new $(a,e.start);return[e,i,o]}}class A{constructor(t,s){this.params=t,this.onValidate=s,this.folder=w.addFolder({title:"Simulation Settings",expanded:!0}),this.textArea=document.createElement("textarea"),this.textArea.rows=10,this.textArea.cols=50,this.textArea.placeholder="Enter Simulation configuration here...",this.textArea.style.width="95%",this.folder.element.appendChild(this.textArea),this.button=this.folder.addButton({title:"Validate Simulation"}).on("click",()=>{this.validate()})}validate(){if(this.params.farmValid){try{this.parseinput(this.getInputValue()),this.params.simValid=!0}catch(t){this.params.simValid=!1,console.error(t)}console.log("Simulation validated:",this.params.simValid),this.onValidate&&this.onValidate(this.params.simValid)}}getInputValue(){return this.textArea.value}parseinput(t){let s=t.trim().split(`
`);for(let e=0;e<s.length;e++){let i=s[e].trim();if(i.length===0)throw new Error("Empty step.");this.params.ants.addStep(i,e+1,this.params.rooms,this.params.links)}if(s.length===0)throw new Error("No steps provided.")}}class V{constructor(t,s,e){this.simState=t,this.sim=s,this.params=e,this.container=document.createElement("div"),this.container.id="playback-container",document.body.appendChild(this.container),this.pane=new Tweakpane.Pane({container:this.container}),this.stepInput=this.pane.addInput(this.simState,"step",{min:0,max:this.simState.len,step:1,label:"Position",disabled:this.simState.is_playing}),this.stepInput.on("change",()=>{this.params.vis.updateStep()}),this.speedInput=this.pane.addInput(this.simState,"speed",{min:.1,max:5,step:.1,label:"Speed"}),this.createPlaybackButtons()}createPlaybackButtons(){this.buttonContainer=document.createElement("div"),this.buttonContainer.id="playback-buttons",this.container.appendChild(this.buttonContainer),['<i class="fa fa-step-backward"></i>','<i class="fa fa-play"></i><i class="fa fa-pause"></i>','<i class="fa fa-step-forward"></i>','<i class="material-icons">replay</i>'].forEach((t,s)=>{const e=document.createElement("div");e.innerHTML=t,e.className="playback-button",e.addEventListener("click",()=>this.playbackAction(s)),this.buttonContainer.appendChild(e)})}playbackAction(t){if(this.params.in_anim){this.params.button_buff=t;return}switch(t){case 0:this.sim.stepBack();break;case 1:this.sim.playPause(),this.simState.is_playing&&this.params.gui.playbackController&&this.sim.run();break;case 2:this.sim.stepForward();break;case 3:this.sim.restart();break}this.update()}update(){this.stepInput.disabled=this.simState.is_playing,this.speedInput.disabled=this.simState.is_playing,this.stepInput.refresh()}}class F{constructor(t,s,e,i){this.visualizer=t,this.simState=s,this.param=e,this.gui=i}async run(){for(;this.simState.is_playing&&this.simState.step<this.simState.len&&this.param.gui.playbackController;)this.simState.step++,this.param.in_anim=!0,await this.param.vis.animateToStep(),this.param.in_anim=!1,this.param.button_buff!==-1&&this.gui.playbackController&&(this.gui.playbackController.playbackAction(this.param.button_buff),this.param.button_buff=-1),this.gui.playbackController&&this.gui.playbackController.update();this.simState.is_playing=!1,this.gui.playbackController&&this.gui.playbackController.update()}stepBack(){this.simState.step>0&&!this.simState.is_playing&&(this.simState.step--,this.param.vis.updateStep())}playPause(){this.simState.is_playing=!this.simState.is_playing}stepForward(){this.simState.step<this.simState.len&&!this.simState.is_playing&&(this.simState.step++,this.param.vis.updateStep())}restart(){this.simState.step=0,this.simState.is_playing=!1,this.param.vis.updateStep()}guiUpdate(){this.gui.playbackController.stepInput.disabled=this.simState.is_playing,this.gui.playbackController.speedInput.disabled=this.simState.is_playing,this.gui.playbackController.stepInput.refresh()}}class _{constructor(){this.popupElement=document.createElement("div"),this.popupElement.style.position="fixed",this.popupElement.style.top="50%",this.popupElement.style.left="50%",this.popupElement.style.transform="translate(-50%, -50%)",this.popupElement.style.backgroundColor="#1a1a1a",this.popupElement.style.border="2px solid #ff4d4d",this.popupElement.style.color="#ffffff",this.popupElement.style.padding="20px",this.popupElement.style.borderRadius="10px",this.popupElement.style.boxShadow="0 0 20px rgba(255, 77, 77, 0.7)",this.popupElement.style.display="none",this.popupElement.style.zIndex="1000",this.popupElement.style.width="350px",this.popupElement.style.maxWidth="90%",this.popupElement.style.wordWrap="break-word",this.popupElement.style.textAlign="center",this.popupElement.style.fontFamily="Arial, sans-serif",this.popupElement.style.fontSize="16px",this.messageElement=document.createElement("p"),this.messageElement.style.whiteSpace="pre-line",this.popupElement.appendChild(this.messageElement),this.closeButton=document.createElement("span"),this.closeButton.innerHTML="&times;",this.closeButton.style.position="absolute",this.closeButton.style.top="10px",this.closeButton.style.right="10px",this.closeButton.style.cursor="pointer",this.closeButton.style.fontSize="24px",this.closeButton.style.color="#ff4d4d",this.popupElement.appendChild(this.closeButton),document.body.appendChild(this.popupElement),this.closeButton.addEventListener("click",()=>{this.hide()}),this.isVisible=!1}show(t){this.isVisible||(this.messageElement.textContent=t,this.popupElement.style.display="block",this.isVisible=!0)}hide(){this.popupElement.style.display="none",this.isVisible=!1}}new Tweakpane.Pane;const f={is_playing:!1,in_anim:!1,button_buff:-1,len:0,step:0,speed:1},d={farmValid:!1,simValid:!1,rooms:null,links:null,ants:null,sim:null,simState:f,vis:null,canvas:null,gui:null,popup:new _},m={antFarmForm:null,simulationForm:null,playbackController:null};d.gui=m;const g=document.createElement("canvas");g.width=window.innerWidth;g.height=window.innerHeight;document.body.appendChild(g);d.canvas=g;m.antFarmForm=new M(d,h=>{m.simulationForm.button.disabled=!h});m.simulationForm=new A(d,h=>{h&&d.simValid&&(d.ants&&(f.len=d.ants.steps),m.playbackController=new V(f,m.simulation,d),f.is_playing=!1,f.step=0,f.speed=1,d.simulation=new F(d.vis,f,d,m),m.playbackController.sim=d.simulation,m.playbackController.stepInput.disabled=f.is_playing,m.playbackController.speedInput.disabled=f.is_playing,m.playbackController.stepInput.refresh())});let R=`9
##start
a 2 5
##end
p 18 12
b 5 10
c 8 4
d 11 7
e 14 2
f 16 9
g 12 14
h 6 12
i 3 14
j 10 2
k 15 4
l 7 8
m 13 11
n 9 11
o 4 7
a-b
a-o
b-c
b-l
c-j
c-d
d-k
d-n
e-j
e-k
f-m
f-n
g-m
g-p
h-i
h-n
i-o
k-f
k-p
l-h
m-n
o-l`,B=`L1-b L2-o 
L1-c L2-i L3-b L4-o 
L1-d L2-h L3-c L4-i L5-b L6-o 
L1-k L2-n L3-d L4-h L5-c L6-i L7-b L8-o 
L1-p L2-m L3-k L4-n L5-d L6-h L7-c L8-i L9-b 
L2-g L3-p L4-m L5-k L6-n L7-d L8-h L9-c 
L2-p L4-g L5-p L6-m L7-k L8-n L9-d 
L4-p L6-g L7-p L8-m L9-k 
L6-p L8-g L9-p 
L8-p`;m.antFarmForm.textArea.value=R;m.simulationForm.textArea.value=B;
